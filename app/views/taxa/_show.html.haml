= javascript_include_tag('taxa-page.js')
%input#taxon_concept_to_log{ :name => "data_objects_to_log", :type => "hidden", :value => @taxon_concept.id }
- # default to regular page separator if we can't find a specific kingdom
- page_separator="page-separator-kingdom"
- if entry_in_col = @taxon_concept.find_ancestor_in_hierarchy(Hierarchy.default)
  - page_separator="page-separator-#{entry_in_col.kingdom_entry.name.string.downcase}"
.page-separator{ :id => page_separator }
#page-title
  - title_names_class =  (@taxon_concept.vetted_id != Vetted.trusted.id) ? "unvetted-title-names" : ""
  %div{:class => title_names_class}
    %h1
      = hh(@taxon_concept.title(@session_hierarchy))
    %h2
      = hh(@taxon_concept.subtitle(@session_hierarchy))
      - if current_user.can_curate?(@taxon_concept)
        %span#curate-common-names
          = link_to( I18n.t(:viewedit_common_name) , "#center_content", :class => 'ajax_delay_click', :onclick => ajax_delay_click)
    %hr
    - if !@taxon_concept.classification_attribution(@session_hierarchy).empty?
      %span.classification-attribution-name
        == #{@taxon_concept.entry.rank_label.capitalize} #{I18n.t("recognized_by")}  |
          #{citables_to_icons(@taxon_concept.classification_attribution(@session_hierarchy).reverse, |
            :show_text_if_no_icon=>true, :only_show_col_icon=>true, :separator=>',&nbsp;', |
            :last_separator=>' in ', :taxon_concept => @taxon_concept)} |
      %br
  #post-info.clearfix
    %span.iucn-status
      - if @taxon_concept.iucn_conservation_status != ''
        == #{ I18n.t(:iucn_red_list_status) }:
        %span.iucn-status-value
          = external_link_to(@taxon_concept.iucn_conservation_status,@taxon_concept.iucn_conservation_status_url)
      - else
        &nbsp;
    %span.page-status
      =I18n.t("showing_")
      = current_user.expertise.to_s == 'expert' ? link_to(I18n.t("scientific_names"), taxon_concept_url(:id=>@taxon_concept.id) + '?expertise=middle',{:title=>'click to show common names'}) : link_to('common names', taxon_concept_url(:id=>@taxon_concept.id) + '?expertise=expert',{:title=>'click to show scientific names'})
    %hr
= render(:partial => 'mediacenter', :locals => {:current_user => current_user})
#page-content-bgfaux
  #page-content.clearfix
    #left-page-content
      %input#current_taxon_concept_id{ :name => "current_taxon_concept_id", :type => "hidden", :value => @taxon_concept.id }
      %input#current_content{ :name => "current_content", :type => "hidden", :value => @category_id }
      %input#canonical_form{ :name => "canonical_form", :type => "hidden", :value => strip_tags(@taxon_concept.entry.name.canonical_form.string) }
      %h4#toc-header.margin-header.left-margin-header
        = I18n.t(:table_of_contents) 
      %ul#toc
        - unless @taxon_concept.table_of_contents(:vetted_only=>current_user.vetted).blank?
          - for item in @taxon_concept.table_of_contents(:vetted_only=>true)
            - item_class = item.is_child? ? 'li-sub' : 'li-major'
            - # NOTE: yes, we really DO need to show items with no content: they can be "parents" to other items.  Do not remove.
            %li{ :class => item_class }
              
              - if item.has_content?
                - a_class = 'toc_item ajax_delay_click'
                - a_class += ' bold' if item.is_child? 
                = link_to(item.label, "/taxa/content/#{@taxon_concept.id}?category_id=#{item.category_id}", :id => "category_id_#{item.category_id}", :class => "#{a_class} taxon_concept_#{@taxon_concept.id} #{[@category_id].include?(item.category_id) ? "active" : nil}".strip, :onclick => ajax_delay_click)
              - else
                %span.no_toc_link
                  = item.label
        %li.add_text
          - change_toc_url = url_for(:controller => 'taxa', :action => 'user_text_change_toc', :taxon_concept_id => @taxon_concept.id)
          - add_text_url = url_for(:controller => :data_objects, :action => :new, :type => :text, :taxon_concept_id => @taxon_concept.id, :toc_id => @new_text_tocitem_id)
          .add_text_button
            = link_to(I18n.t("_span_style__width_20px_height"), add_text_url, :id => 'new_text_toc_button', 'data-change_toc_url' => change_toc_url, :title => "Add New Content")
          = link_to(I18n.t("add_new_content"), add_text_url, :id => 'new_text_toc_text', 'data-change_toc_url' => change_toc_url )
        %li.multi_new_text_error{ :style => "display:none;" }
          = I18n.t(:only_one_text_object_can_be_edited_at_a_time) 
      %hr
    #center-page-content
      = render :partial => 'content'
    #center-page-content-loading{ :style => "display:none;" }
      = image_tag 'indicator_arrows_black.gif', :alt=>I18n.t("working__")
    #right-page-content
      = render :partial => 'feed_items/index', :locals => {:feed => @taxon_concept.feed}
      = render :partial => 'internal_nav'
= render :partial => 'curator_citation'
